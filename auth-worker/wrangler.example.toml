name = "auth-worker"
main = "build/worker/shim.mjs"
compatibility_date = "2024-09-23"

[build]
command = "cd web && npm install && npm run build && cd .. && cargo install -q worker-build && worker-build --release"

# Admin dashboard static assets
[assets]
directory = "./web/dist"
not_found_handling = "single-page-application"
run_worker_first = ["/health", "/verify", "/traffic", "/admin/*"]

# D1 database (source of truth)
# Create with: npx wrangler d1 create auth-db
# Then replace database_id below
[[d1_databases]]
binding = "DB"
database_name = "auth-db"
database_id = "YOUR_D1_DATABASE_ID"

# KV namespace (verify cache)
# Create with: npx wrangler kv namespace create CACHE
# Then replace id below
[[kv_namespaces]]
binding = "CACHE"
id = "YOUR_KV_NAMESPACE_ID"

# Set admin token: npx wrangler secret put ADMIN_TOKEN
